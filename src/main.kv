<CustomOneLineIconListItem>:

    IconLeftWidget:
        icon: root.icon


<Main>:

    MDBoxLayout:
        orientation: 'vertical'
        spacing: dp(10)
        padding: dp(20)

        MDBoxLayout:
            adaptive_height: True
            MDIconButton:
                icon: 'magnify'
            MDTextField:
                id: search_field
                hint_text: 'Search process'
                on_text: root.fast_answer(self.text)
            MDIconButton:
                icon: 'menu'
                on_release: app.navigator.ids.nav_drawer.set_state("open")

        MDBoxLayout:
            adaptive_height: True
            MDCheckbox:
                id: multiple_select
                size_hint: None, None
                size: "48dp", "48dp"
                pos_hint: {'center_x': .5, 'center_y': .5}
                on_press: app.selection_lock.acquire()
                on_release:
                    app.select_rows(self.active)
                    app.selection_lock.release()
            AnchorLayout:
                anchor_x: "center"
                anchor_y: "center"
                size_hint: None, None
                size: 50, 50
                IButton:
                    id: order
                    size_hint: None, None
                    size: 32, 32
                    icon: "arrow-down"
                    color: app.theme_cls.opposite_bg_normal
                    on_release: app.sort_by(app.sorted_by, "arrow-up" if self.icon == "arrow-down" else "arrow-down")
            LButton:
                size_hint_x: None
                width: "48dp"
                text: "PID"
            LButton:
                text: "Process Name"
            LButton:
                text: "CPU Usage"
            LButton:
                text: "Memory Usage"

        RecycleView:
            id: rv
            viewclass: 'ProcessCell'

            RecycleBoxLayout:
                default_size: None, dp(48)
                default_size_hint: 1, None
                size_hint_y: None
                height: self.minimum_height
                orientation: 'vertical'

        MDBoxLayout:
            adaptive_height: True
            MDIconButton:
                icon: "arrow-up-drop-circle-outline"
                on_release: rv.scroll_y = 1
            MDIconButton:
                icon: "arrow-down-drop-circle-outline"
                on_release: rv.scroll_y = 0
            MDLabel:
                id: selection_label
                shorten: True
                shorten_from: "left"
                color: app.theme_cls.opposite_bg_normal
            MDBoxLayout:
                adaptive_width: True
                spacing: "10dp"
                MDRaisedButton:
                    text: "KILL"
                    on_release: app.kill_selected()
                MDRaisedButton:
                    text: "THE CHILDREN TOO"
                    on_release: app.kill_selected_and_children()

<ProcessCell>
    adaptive_height: True
    MDCheckbox:
        size_hint: None, None
        size: "48dp", "48dp"
        pos_hint: {'center_x': .5, 'center_y': .5}
        active: root.proc_pid in app.current_selection
        on_active: app.select_row(root.proc_pid, self.active)
    AnchorLayout:
        anchor_x: "center"
        anchor_y: "center"
        size_hint: None, None
        size: 50, 50
        MDIcon:
            size_hint: None, None
            size: 32, 32
            icon: root.proc_icon
    MDLabel:
        size_hint_x: None
        width: "48dp"
        text: root.proc_pid
        color: app.theme_cls.opposite_bg_normal
    MDLabel:
        text: root.proc_name
        color: app.theme_cls.opposite_bg_normal
    MDLabel:
        text: root.proc_cpu
        halign: "center"
        color: app.theme_cls.opposite_bg_normal
    MDLabel:
        text: root.proc_mem
        halign: "center"
        color: app.theme_cls.opposite_bg_normal

<LButton@ButtonBehavior+MDLabel>
    sorted_by: self.text == app.sorted_by
    canvas.before:
        Color:
            rgba: app.theme_cls.primary_color if self.sorted_by else (0, 0, 0, 0)
        Rectangle:
            pos: self.pos
            size: self.size
    on_release: app.sort_by(self.text, app.main.ids.order.icon)
    halign: "center"
    color: (1, 1, 1, 1) if self.sorted_by else app.theme_cls.opposite_bg_normal

<IButton@ButtonBehavior+MDIcon>
    color: app.theme_cls.opposite_bg_normal

<MiniProcessCell>
    text: self.proc_name
    on_size:
        self.ids._right_container.width = container.width
        self.ids._right_container.x = container.width
    IconLeftWidget:
        size_hint: None, None
        size: 32, 32
        icon: root.proc_icon
    Container:
        id: container
        MDLabel:
            text: root.proc_pid
            halign: "center"
            color: app.theme_cls.opposite_bg_normal
        MDLabel:
            text: root.proc_user
            halign: "center"
            font_size: root.little_font if root.little_font is not None else self.font_size
            color: app.theme_cls.opposite_bg_normal

<Container@IRightBodyTouch+MDBoxLayout>

<Navigator>
    ScreenManager
        id: sm
    MDNavigationDrawer:
        id: nav_drawer
        anchor: 'right'

        MDBoxLayout:
            orientation: 'vertical'
            MDBoxLayout:
                adaptive_height: True
                Widget
                MDIconButton:
                    id: style_button
                    dark: False
                    icon: 'moon-waxing-crescent' if not self.dark else 'white-balance-sunny'
                    on_release:
                        self.dark = not self.dark
                        app.theme_cls.theme_style = "Dark" if self.dark else "Light"